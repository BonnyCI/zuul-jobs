- hosts: all
  # We're gathering facts here so that we can emit things in the debug-ansible
  # role. We also need facts in bindep.
  # Don't copy-pasta this. Zuul runs ansible with gathering = explicit
  gather_facts: true
  gather_subset:
    - "!all"
  roles:
    - role: configure-mirrors
      # TODO(mordred) When we have site-local variables, these should go there
      mirror_host: "mirror.{{ nodepool.region | lower }}.{{ nodepool.provider | lower }}.openstack.org"
      mirror_domain: openstack.org
    - role: validate-host
      # TODO(mordred) When we have site-local variables, these should go there
      zuul_traceroute_host: git.openstack.org
      zuul_image_manifest: /etc/dib-builddate.txt
    - role: bindep
      bindep_profile: test
      bindep_dir: "{{ zuul_work_dir }}"
      # TODO(mordred) When we have site-local variables, these should go there
      bindep_command: /usr/bindep-env/bin/bindep
      bindep_fallback: /usr/local/jenkins/common_data/bindep-fallback.txt
    - test-setup
    - revoke-sudo
